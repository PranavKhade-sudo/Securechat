<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LINK â€” Private Chat</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap" rel="stylesheet"/>
<style>
:root {
  --bg:      #080a0f;
  --surface: #0e1118;
  --card:    #13171f;
  --border:  #1e2330;
  --accent:  #4f8eff;
  --accent2: #7c3aed;
  --danger:  #ef4444;
  --text:    #e8eaf0;
  --muted:   #5a6278;
  --online:  #22c55e;
  --mono:    'Space Mono', monospace;
  --sans:    'Syne', sans-serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--sans);
  background: var(--bg);
  color: var(--text);
  height: 100dvh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* Subtle noise texture overlay */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* â”€â”€ LANDING / ROOM JOIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#landing {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100dvh;
  gap: 0;
  position: relative;
  z-index: 1;
}

.landing-glow {
  position: absolute;
  width: 600px; height: 600px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(79,142,255,0.08) 0%, transparent 70%);
  pointer-events: none;
}

.brand {
  font-family: var(--sans);
  font-size: 72px;
  font-weight: 800;
  letter-spacing: -2px;
  background: linear-gradient(135deg, #fff 0%, var(--accent) 60%, var(--accent2) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  line-height: 1;
  margin-bottom: 8px;
}

.tagline {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--muted);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 48px;
}

.join-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: 36px;
  width: 100%;
  max-width: 420px;
  display: flex;
  flex-direction: column;
  gap: 16px;
  box-shadow: 0 32px 80px rgba(0,0,0,0.6),
              0 0 0 1px rgba(255,255,255,0.03);
}

.join-card label {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: -8px;
}

.field {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 14px 16px;
  color: var(--text);
  font-family: var(--mono);
  font-size: 14px;
  outline: none;
  width: 100%;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.field:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(79,142,255,0.12);
}
.field::placeholder { color: var(--muted); }

.join-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none;
  border-radius: 12px;
  padding: 15px;
  color: #fff;
  font-family: var(--sans);
  font-size: 15px;
  font-weight: 700;
  letter-spacing: 1px;
  cursor: pointer;
  transition: opacity 0.2s, transform 0.15s;
  margin-top: 4px;
}
.join-btn:hover { opacity: 0.9; transform: translateY(-1px); }
.join-btn:active { transform: translateY(0); }

.room-hint {
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  text-align: center;
  margin-top: -4px;
}

/* â”€â”€ CHAT LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app {
  display: none;
  flex-direction: column;
  height: 100dvh;
  position: relative;
  z-index: 1;
}

/* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 20px;
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.header-left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.header-brand {
  font-size: 20px;
  font-weight: 800;
  background: linear-gradient(135deg, #fff, var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.room-badge {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 4px 12px;
  font-family: var(--mono);
  font-size: 12px;
  color: var(--accent);
  display: flex;
  align-items: center;
  gap: 6px;
}
.room-badge::before {
  content: '';
  width: 6px; height: 6px;
  border-radius: 50%;
  background: var(--online);
  box-shadow: 0 0 6px var(--online);
}

.header-actions {
  display: flex;
  gap: 8px;
}

.icon-btn {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 8px 14px;
  color: var(--muted);
  font-family: var(--mono);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}
.icon-btn:hover { border-color: var(--accent); color: var(--accent); }
.icon-btn.danger:hover { border-color: var(--danger); color: var(--danger); }

/* Messages area */
.messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 4px;
  scroll-behavior: smooth;
}
.messages::-webkit-scrollbar { width: 4px; }
.messages::-webkit-scrollbar-track { background: transparent; }
.messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

/* Message bubbles */
.msg-group {
  display: flex;
  flex-direction: column;
  max-width: 75%;
  animation: msgIn 0.2s ease;
}
@keyframes msgIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

.msg-group.mine { align-self: flex-end; align-items: flex-end; }
.msg-group.theirs { align-self: flex-start; align-items: flex-start; }

.msg-meta {
  font-family: var(--mono);
  font-size: 10px;
  color: var(--muted);
  margin-bottom: 4px;
  padding: 0 4px;
}

.bubble {
  padding: 10px 14px;
  border-radius: 18px;
  font-size: 14px;
  line-height: 1.5;
  word-break: break-word;
  position: relative;
}

.mine .bubble {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  border-bottom-right-radius: 4px;
}

.theirs .bubble {
  background: var(--card);
  border: 1px solid var(--border);
  color: var(--text);
  border-bottom-left-radius: 4px;
}

.bubble + .bubble { margin-top: 2px; }
.mine .bubble + .bubble { border-bottom-right-radius: 18px; }
.mine .bubble:last-child { border-bottom-right-radius: 4px; }
.theirs .bubble + .bubble { border-bottom-left-radius: 18px; }
.theirs .bubble:last-child { border-bottom-left-radius: 4px; }

.msg-time {
  font-family: var(--mono);
  font-size: 9px;
  color: rgba(255,255,255,0.5);
  margin-top: 2px;
  padding: 0 4px;
}

/* System messages */
.sys-msg {
  text-align: center;
  font-family: var(--mono);
  font-size: 11px;
  color: var(--muted);
  padding: 8px;
  animation: msgIn 0.3s ease;
}

/* Day separator */
.day-sep {
  display: flex;
  align-items: center;
  gap: 12px;
  margin: 12px 0;
  color: var(--muted);
  font-family: var(--mono);
  font-size: 10px;
  letter-spacing: 1px;
}
.day-sep::before, .day-sep::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border);
}

/* Input area */
.input-area {
  padding: 16px 20px;
  background: var(--surface);
  border-top: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: flex-end;
  flex-shrink: 0;
}

.msg-input {
  flex: 1;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 12px 16px;
  color: var(--text);
  font-family: var(--sans);
  font-size: 14px;
  outline: none;
  resize: none;
  max-height: 120px;
  transition: border-color 0.2s, box-shadow 0.2s;
  line-height: 1.5;
}
.msg-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(79,142,255,0.1);
}
.msg-input::placeholder { color: var(--muted); }

.send-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none;
  border-radius: 14px;
  width: 46px; height: 46px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: opacity 0.2s, transform 0.15s;
  flex-shrink: 0;
}
.send-btn:hover { opacity: 0.85; transform: scale(1.05); }
.send-btn:active { transform: scale(0.97); }
.send-btn svg { width: 18px; height: 18px; fill: none; stroke: #fff; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }

/* Nickname pill in input area */
.nick-pill {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 6px 14px;
  font-family: var(--mono);
  font-size: 12px;
  color: var(--accent);
  cursor: pointer;
  white-space: nowrap;
  transition: border-color 0.2s;
  flex-shrink: 0;
  align-self: flex-end;
  margin-bottom: 2px;
}
.nick-pill:hover { border-color: var(--accent); }

/* Modal */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px);
  z-index: 100;
  align-items: center;
  justify-content: center;
}
.modal-overlay.show { display: flex; }

.modal {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 28px;
  width: 90%;
  max-width: 360px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.8);
}
.modal h3 {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 6px;
}
.modal p {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 20px;
  line-height: 1.5;
}
.modal-btns {
  display: flex;
  gap: 10px;
}
.modal-btn {
  flex: 1;
  padding: 12px;
  border-radius: 12px;
  border: none;
  font-family: var(--sans);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: opacity 0.2s;
}
.modal-btn:hover { opacity: 0.85; }
.modal-btn.cancel { background: var(--surface); color: var(--muted); border: 1px solid var(--border); }
.modal-btn.confirm { background: var(--danger); color: #fff; }

/* Toast */
.toast {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 10px 20px;
  font-family: var(--mono);
  font-size: 12px;
  color: var(--text);
  opacity: 0;
  transition: all 0.3s;
  pointer-events: none;
  z-index: 200;
  white-space: nowrap;
}
.toast.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* Nickname edit modal field */
.modal .field { margin-bottom: 0; }

/* Scrollbar for textarea */
.msg-input::-webkit-scrollbar { width: 3px; }
.msg-input::-webkit-scrollbar-thumb { background: var(--border); }
</style>
</head>
<body>

<!-- â”€â”€ LANDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="landing">
  <div class="landing-glow"></div>
  <div class="brand">LINK</div>
  <div class="tagline">Private Â· Ephemeral Â· Secure</div>
  <div class="join-card">
    <label>Your Name</label>
    <input class="field" id="ln-nick" placeholder="Enter nickname..." maxlength="20"/>
    <label>Room Code</label>
    <input class="field" id="ln-room" placeholder="e.g. alpha-7 or 1234..." maxlength="30"/>
    <button class="join-btn" id="ln-join">Enter Room â†’</button>
    <div class="room-hint">// messages exist only while you're connected</div>
  </div>
</div>

<!-- â”€â”€ CHAT APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="app">
  <div class="header">
    <div class="header-left">
      <div class="header-brand">LINK</div>
      <div class="room-badge" id="room-label">room</div>
    </div>
    <div class="header-actions">
      <button class="icon-btn" id="copy-link-btn">âŽ˜ Copy Link</button>
      <button class="icon-btn danger" id="clear-btn">âœ• Clear Chat</button>
    </div>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <div class="nick-pill" id="nick-display" title="Click to change name">ðŸ‘¤ me</div>
    <textarea class="msg-input" id="msg-input" placeholder="Type a message..." rows="1"></textarea>
    <button class="send-btn" id="send-btn">
      <svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
    </button>
  </div>
</div>

<!-- â”€â”€ CLEAR CONFIRM MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="clear-modal">
  <div class="modal">
    <h3>Clear Chat?</h3>
    <p>This will permanently delete all messages in this room for everyone. This cannot be undone.</p>
    <div class="modal-btns">
      <button class="modal-btn cancel" id="clear-cancel">Cancel</button>
      <button class="modal-btn confirm" id="clear-confirm">Delete All</button>
    </div>
  </div>
</div>

<!-- â”€â”€ NICKNAME MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-overlay" id="nick-modal">
  <div class="modal">
    <h3>Change Name</h3>
    <p>This only changes your display name going forward.</p>
    <input class="field" id="nick-input" placeholder="New nickname..." maxlength="20" style="margin-bottom:16px"/>
    <div class="modal-btns">
      <button class="modal-btn cancel" id="nick-cancel">Cancel</button>
      <button class="modal-btn confirm" style="background:var(--accent)" id="nick-save">Save</button>
    </div>
  </div>
</div>

<!-- â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toast" id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getDatabase, ref, push, onChildAdded,
  limitToLast, query, remove, get
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDi6kx4nSM0leIsQ0m9UxqBlE699nozUBs",
  authDomain: "link-37ce7.firebaseapp.com",
  databaseURL: "https://link-37ce7-default-rtdb.firebaseio.com",
  projectId: "link-37ce7",
  storageBucket: "link-37ce7.firebasestorage.app",
  messagingSenderId: "864342278827",
  appId: "1:864342278827:web:81059b56b947df8ad2adee",
  measurementId: "G-6B40R1LXJ1"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app);

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let nickname = localStorage.getItem('lk-nick') || '';
let room     = '';
let chatRef  = null;
let lastSender = null;
let lastDate   = null;

// â”€â”€ Utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

function formatTime(ts) {
  return new Date(ts).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}
function formatDate(ts) {
  return new Date(ts).toLocaleDateString([], { weekday:'long', month:'short', day:'numeric' });
}

function isSameDay(a, b) {
  const da = new Date(a), db = new Date(b);
  return da.getDate()===db.getDate() && da.getMonth()===db.getMonth() && da.getFullYear()===db.getFullYear();
}

// â”€â”€ Landing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const landing   = document.getElementById('landing');
const appEl     = document.getElementById('app');
const lnNick    = document.getElementById('ln-nick');
const lnRoom    = document.getElementById('ln-room');
const lnJoin    = document.getElementById('ln-join');

// Pre-fill from URL
const urlParams = new URLSearchParams(window.location.search);
const urlRoom   = urlParams.get('room');
if(urlRoom) lnRoom.value = urlRoom;
lnNick.value = nickname;

lnJoin.addEventListener('click', joinRoom);
lnRoom.addEventListener('keypress', e => { if(e.key==='Enter') joinRoom(); });
lnNick.addEventListener('keypress', e => { if(e.key==='Enter') lnRoom.focus(); });

function joinRoom() {
  const nick = lnNick.value.trim();
  const rm   = lnRoom.value.trim();
  if(!nick) { lnNick.focus(); lnNick.style.borderColor='var(--danger)'; return; }
  if(!rm)   { lnRoom.focus(); lnRoom.style.borderColor='var(--danger)'; return; }
  nickname = nick;
  room     = rm;
  localStorage.setItem('lk-nick', nickname);
  // Update URL without reload
  const url = new URL(window.location);
  url.searchParams.set('room', room);
  window.history.pushState({}, '', url);
  startChat();
}

// â”€â”€ Chat init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startChat() {
  landing.style.display = 'none';
  appEl.style.display   = 'flex';
  document.getElementById('room-label').textContent = '# ' + room;
  document.getElementById('nick-display').textContent = 'ðŸ‘¤ ' + nickname;
  chatRef = ref(db, 'rooms/' + room);
  listenMessages();
}

// â”€â”€ Messages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const messagesEl = document.getElementById('messages');

function listenMessages() {
  const q = query(chatRef, limitToLast(200));
  onChildAdded(q, snap => {
    const msg = snap.val();
    renderMessage(msg);
  });
}

function renderMessage(msg) {
  const isMine = msg.name === nickname;
  const msgDate = formatDate(msg.time);

  // Day separator
  if(!lastDate || lastDate !== msgDate) {
    const sep = document.createElement('div');
    sep.className = 'day-sep';
    sep.textContent = msgDate;
    messagesEl.appendChild(sep);
    lastDate   = msgDate;
    lastSender = null;
  }

  // Group consecutive messages from same sender
  if(lastSender === msg.name) {
    // Add bubble to existing group
    const groups = messagesEl.querySelectorAll('.msg-group');
    const last   = groups[groups.length - 1];
    if(last && last.dataset.sender === msg.name) {
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = msg.text;
      last.appendChild(bubble);
      const timeEl = last.querySelector('.msg-time');
      if(timeEl) timeEl.textContent = formatTime(msg.time);
      messagesEl.scrollTop = messagesEl.scrollHeight;
      return;
    }
  }

  // New group
  const group = document.createElement('div');
  group.className = 'msg-group ' + (isMine ? 'mine' : 'theirs');
  group.dataset.sender = msg.name;

  const meta = document.createElement('div');
  meta.className = 'msg-meta';
  meta.textContent = isMine ? 'You' : msg.name;
  group.appendChild(meta);

  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = msg.text;
  group.appendChild(bubble);

  const timeEl = document.createElement('div');
  timeEl.className = 'msg-time';
  timeEl.textContent = formatTime(msg.time);
  group.appendChild(timeEl);

  messagesEl.appendChild(group);
  lastSender = msg.name;
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

// â”€â”€ Send â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const msgInput = document.getElementById('msg-input');
const sendBtn  = document.getElementById('send-btn');

function sendMessage() {
  const text = msgInput.value.trim();
  if(!text) return;
  push(chatRef, { name: nickname, text, time: Date.now() });
  msgInput.value = '';
  msgInput.style.height = 'auto';
}

sendBtn.addEventListener('click', sendMessage);
msgInput.addEventListener('keypress', e => {
  if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});

// Auto resize textarea
msgInput.addEventListener('input', () => {
  msgInput.style.height = 'auto';
  msgInput.style.height = Math.min(msgInput.scrollHeight, 120) + 'px';
});

// â”€â”€ Copy room link â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('copy-link-btn').addEventListener('click', () => {
  const url = window.location.href;
  navigator.clipboard.writeText(url).then(() => showToast('Room link copied!'));
});

// â”€â”€ Clear chat â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const clearModal   = document.getElementById('clear-modal');
const clearCancel  = document.getElementById('clear-cancel');
const clearConfirm = document.getElementById('clear-confirm');

document.getElementById('clear-btn').addEventListener('click', () => {
  clearModal.classList.add('show');
});
clearCancel.addEventListener('click', () => clearModal.classList.remove('show'));
clearConfirm.addEventListener('click', async () => {
  clearModal.classList.remove('show');
  await remove(chatRef);
  messagesEl.innerHTML = '';
  lastSender = null;
  lastDate   = null;
  showToast('Chat cleared.');
});

// â”€â”€ Change nickname â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const nickModal  = document.getElementById('nick-modal');
const nickInput  = document.getElementById('nick-input');
const nickCancel = document.getElementById('nick-cancel');
const nickSave   = document.getElementById('nick-save');
const nickPill   = document.getElementById('nick-display');

nickPill.addEventListener('click', () => {
  nickInput.value = nickname;
  nickModal.classList.add('show');
  setTimeout(() => nickInput.focus(), 100);
});
nickCancel.addEventListener('click', () => nickModal.classList.remove('show'));
nickSave.addEventListener('click', () => {
  const n = nickInput.value.trim();
  if(!n) return;
  nickname = n;
  localStorage.setItem('lk-nick', nickname);
  nickPill.textContent = 'ðŸ‘¤ ' + nickname;
  nickModal.classList.remove('show');
  showToast('Name updated!');
});
nickInput.addEventListener('keypress', e => { if(e.key==='Enter') nickSave.click(); });

// Close modals on overlay click
[clearModal, nickModal].forEach(m => {
  m.addEventListener('click', e => { if(e.target===m) m.classList.remove('show'); });
});
</script>
</body>
</html>
